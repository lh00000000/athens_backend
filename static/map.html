<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <meta name="google-signin-client_id"
          content="200863470173-hn5o73tfu2v455v98vc861hovsu8eqcq.apps.googleusercontent.com">
    <meta name="google-signin-scope" content="https://www.googleapis.com/auth/analytics.readonly">
</head>
<body>

<!-- The Sign-in button. This will run `queryReports()` on success. -->
<p class="g-signin2" data-onsuccess="queryReports"></p>
<button onclick="handleClientLoad()">load map</button>
<div id="regions_div" style="width: 900px; height: 500px;"></div>

<script>
    // Replace with your view ID.
    function handleClientLoad() {

        var VIEW_ID = '181843413';

        // Query the API and print the results to the page.
        function queryReports() {
            gapi.client.request({
                path: '/v4/reports:batchGet',
                root: 'https://analyticsreporting.googleapis.com/',
                method: 'POST',
                body: {
                    reportRequests: [
                        {
                            viewId: VIEW_ID,
                            dateRanges: [
                                {
                                    startDate: '1000daysAgo',
                                    endDate: 'today'
                                }
                            ],
                            dimensions: [
                                {
                                    name: 'ga:country'
                                }
                            ]
                        }
                    ]
                }
            }).then(drawRegionsMap, console.error.bind(console));
        }

        // function displayResults(response) {
        //     var formattedJson = JSON.stringify(response.result, null, 2);
        //     document.getElementById('query-output').value = formattedJson;
        // }

        google.charts.load('current', {
            'packages': ['geochart'],
            // Note: you will need to get a mapsApiKey for your project.
            // See: https://developers.google.com/chart/interactive/docs/basic_load_libs#load-settings
            'mapsApiKey': 'AIzaSyD_oMAWCjdUkSygX7iYsAa8Qyw7yIYTbiw'
        });

        // google.charts.setOnLoadCallback(drawRegionsMap);

        function drawRegionsMap(response) {
            var countries = response.result.reports[0].data.rows.map(c => [c.dimensions[0], parseInt(c.metrics[0].values[0])]);
            var data = google.visualization.arrayToDataTable([['Country', 'Popularity']].concat(countries));

            var options = {
                colorAxis: {colors: ['#00853f', 'black', '#e31b23']},
                backgroundColor: '#81d4fa',
                datalessRegionColor: '#f8bbd0',
                defaultColor: '#f5f5f5',
            };

            var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));

            chart.draw(data, options);
        }

        queryReports();

    }

</script>
<script src="https://apis.google.com/js/client:platform.js"></script>

</body>
</html>
